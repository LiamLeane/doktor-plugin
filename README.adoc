= Doktor

Doktor is a Jenkins plugin for automated documentation uploading to Confluence.

== Usage

As you may suspect Confluence REST API requires authentication.
Doktor supports basic authentication (username and password).
So, first thing to do is to https://github.com/jenkinsci/credentials-plugin/blob/master/docs/user.adoc[configure credentials] in Jenkins.

Create a "Username with password" credentials to be used to authenticate on Confluence server:

image::https://github.com/madhead/doktor/blob/master/.github/images/new_credentials.png[]

You may have as many Confluence servers and credentials for them as you need.

Next thing to do is to configure Confluence servers.
Go to global configuration screen ("Manage Jenkins" -> "Configure System") and find "Confluence Servers" section.
Configure the list of available Confluence servers:

image::https://github.com/madhead/doktor/blob/master/.github/images/confluence_servers.png[]


== Developing

Doktor is built with https://kotlinlang.org/[Kotlin], https://gradle.org/[Gradle] and Love.
Well, actually with hate to the workflows on my day-time job.

JPI artifact is produced with https://github.com/jenkinsci/gradle-jpi-plugin[Gradle's JPI plugin].
Read its documentation to know more about supported features and options.

Also, take a look at https://github.com/SimpleFinance/jenkins-firebase-test-plugin[this Jenkins plugin], which is build in Gradle and Kotlin too!

=== Building & running

Basically, `./gradlew --rerun-tasks clean jpi server` will spin up a Jenkins with Doktor installed.
`--rerun-tasks` is used to force clean build every time because Gradle aggressively caches build outputs, especially https://kotlinlang.org/docs/reference/kapt.html[Kotlin annotation processing tool] results.


Debug is supported as well:

----
GRADLE_OPTS="-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005" ./gradlew --rerun-tasks clean jpi server
----


Omit `server` task if you just need a JPI file.
